---
title: Testing
description: Learn how to test your DayFlow calendar implementation
---

# Testing

DayFlow comes with a comprehensive testing setup using Jest and React Testing Library. This guide will help you write tests for your calendar implementation.

## Test Environment

The package uses:
- **Jest** - Test framework
- **React Testing Library** - Component testing utilities
- **ts-jest** - TypeScript support for Jest

## Running Tests

```bash
# Run all tests
npm test

# Run tests in watch mode
npm run test:watch

# Generate coverage report
npm run test:coverage
```

## Testing Calendar Components

### Basic Event Management

```typescript
import { CalendarApp } from '@dayflow/core';
import { ViewType } from 'dayflow-core/types';
import { Temporal } from 'temporal-polyfill';

describe('Calendar Events', () => {
  it('should add an event', () => {
    const app = new CalendarApp({
      views: [createMonthView()],
      plugins: [],
      events: [],
      defaultView: ViewType.MONTH,
    });

    const event = {
      id: 'test-1',
      title: 'Test Event',
      start: Temporal.Now.plainDateISO(),
      end: Temporal.Now.plainDateISO(),
    };

    app.addEvent(event);
    expect(app.getAllEvents()).toHaveLength(1);
  });
});
```

### Testing with React Components

```typescript
import { render, screen } from '@testing-library/react';
import { DayFlowCalendar } from '@dayflow/core';
import { useCalendarApp } from '@dayflow/core';

describe('DayFlowCalendar', () => {
  it('should render calendar', () => {
    const TestComponent = () => {
      const calendar = useCalendarApp({
        views: [createMonthView()],
        plugins: [],
        events: [],
        defaultView: ViewType.MONTH,
      });

      return <DayFlowCalendar calendar={calendar} />;
    };

    render(<TestComponent />);
    expect(screen.getByRole('grid')).toBeInTheDocument();
  });
});
```

## Test Utilities

### Helper Functions

```typescript
import {
  isMultiDayEvent,
  formatTime,
  roundToTimeStep,
} from 'dayflow-core/utils';

describe('Date Helpers', () => {
  it('should format time correctly', () => {
    expect(formatTime(9, 30)).toBe('09:30');
    expect(formatTime(14, 0)).toBe('14:00');
  });

  it('should round to time step', () => {
    expect(roundToTimeStep(9.3)).toBe(9.25); // 15 min intervals
  });
});
```

### Temporal API Testing

```typescript
import { Temporal } from 'temporal-polyfill';

describe('Temporal Events', () => {
  it('should handle PlainDate', () => {
    const date = Temporal.PlainDate.from('2025-01-15');
    expect(date.year).toBe(2025);
    expect(date.month).toBe(1);
    expect(date.day).toBe(15);
  });

  it('should handle ZonedDateTime', () => {
    const zdt = Temporal.ZonedDateTime.from(
      '2025-01-15T09:00:00[UTC]'
    );
    expect(zdt.hour).toBe(9);
  });
});
```

## Coverage Goals

The project aims for:
- **70%+** overall code coverage
- **80%+** for critical calendar logic
- **90%+** for utility functions

Check current coverage:

```bash
npm run test:coverage
```

## Best Practices

1. **Test User Behavior** - Focus on testing what users do, not implementation details
2. **Use Descriptive Names** - Test names should explain what's being tested
3. **Mock External Dependencies** - Keep tests isolated and fast
4. **Test Edge Cases** - Multi-day events, timezone boundaries, DST transitions
5. **Snapshot Tests** - Use sparingly for UI components

## Common Testing Patterns

### Testing Event CRUD

```typescript
describe('Event Operations', () => {
  let app: CalendarApp;

  beforeEach(() => {
    app = new CalendarApp({
      views: [createMonthView()],
      plugins: [],
      events: [],
      defaultView: ViewType.MONTH,
    });
  });

  it('should create event', () => {
    // Arrange
    const event = { id: '1', title: 'Test', /* ... */ };

    // Act
    app.addEvent(event);

    // Assert
    expect(app.getAllEvents()).toContainEqual(event);
  });

  it('should update event', () => {
    const event = { id: '1', title: 'Original', /* ... */ };
    app.addEvent(event);

    app.updateEvent('1', { title: 'Updated' });

    const updated = app.getAllEvents()[0];
    expect(updated.title).toBe('Updated');
  });

  it('should delete event', () => {
    const event = { id: '1', title: 'Test', /* ... */ };
    app.addEvent(event);

    app.deleteEvent('1');

    expect(app.getAllEvents()).toHaveLength(0);
  });
});
```

### Testing Drag and Drop

```typescript
import { fireEvent } from '@testing-library/react';

describe('Drag Operations', () => {
  it('should handle drag start', () => {
    const { container } = render(<CalendarWithDrag />);
    const event = container.querySelector('[data-event-id="1"]');

    fireEvent.mouseDown(event!, { clientX: 100, clientY: 100 });

    expect(event).toHaveAttribute('data-dragging', 'true');
  });
});
```

## CI/CD Integration

The tests run automatically on:
- Every push to main/docs branches
- Pull requests
- Before publishing (prepublishOnly script)

See `.github/workflows/test.yml` for the complete CI configuration.

## Troubleshooting

### Common Issues

**Invalid Hook Call**
```
Error: Invalid hook call. Hooks can only be called inside...
```
Solution: Ensure React versions match between your app and DayFlow.

**Temporal API Errors**
```
ReferenceError: Temporal is not defined
```
Solution: Import `temporal-polyfill` in your test setup:
```typescript
// setupTests.ts
import 'temporal-polyfill';
```

**Async Testing Issues**
```typescript
// Use waitFor for async operations
import { waitFor } from '@testing-library/react';

await waitFor(() => {
  expect(screen.getByText('Event Title')).toBeInTheDocument();
});
```

## Next Steps

- [Contributing Guidelines](/docs/contributing)
- [API Reference](/docs/api)
- [Performance Testing](/docs/performance)
