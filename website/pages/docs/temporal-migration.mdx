# Temporal API Migration Guide

Day Flow now uses the modern [Temporal API](https://tc39.es/proposal-temporal/docs/) for date and time handling, replacing the legacy `Date` object. This guide will help you migrate your existing code.

## Why Temporal?

The Temporal API offers significant advantages over the legacy `Date` object:

- **Better timezone handling** - First-class timezone support
- **Immutability** - All Temporal objects are immutable
- **Clarity** - Separate types for dates, times, and date-times
- **Precision** - Nanosecond precision
- **Type safety** - Better TypeScript support
- **Standards-based** - TC39 Stage 3 proposal

## What Changed

### Event Interface

**Before (Date):**

```tsx
interface LegacyEvent {
  id: string;
  title: string;
  start: Date;
  end: Date;
  timezone?: string; // Optional, often forgotten
  allDay?: boolean;
}
```

**After (Temporal):**

```tsx
interface Event {
  id: string;
  title: string;
  // Three types supported:
  // - PlainDate: all-day events
  // - PlainDateTime: local events (recommended)
  // - ZonedDateTime: timezone-aware events
  start: Temporal.PlainDate | Temporal.PlainDateTime | Temporal.ZonedDateTime;
  end: Temporal.PlainDate | Temporal.PlainDateTime | Temporal.ZonedDateTime;
  allDay?: boolean;
}
```

## Key Concepts

### Choosing the Right Temporal Type

- **`Temporal.PlainDate`** - For all-day events (no time, no timezone)
- **`Temporal.PlainDateTime`** - For local events (date + time, no timezone) ✨ **Recommended for most use cases**
- **`Temporal.ZonedDateTime`** - For timezone-aware events (international meetings, flights)

```tsx
import { Temporal } from 'temporal-polyfill';

// All-day event
const allDayEvent: Event = {
  id: '1',
  title: 'Conference',
  start: Temporal.PlainDate.from('2024-10-15'),
  end: Temporal.PlainDate.from('2024-10-17'),
  allDay: true,
};

// Local timed event (recommended for most cases)
const localEvent: Event = {
  id: '2',
  title: 'Team Meeting',
  start: Temporal.PlainDateTime.from({
    year: 2024, month: 10, day: 15,
    hour: 10, minute: 0
  }),
  end: Temporal.PlainDateTime.from({
    year: 2024, month: 10, day: 15,
    hour: 11, minute: 0
  }),
};

// Timezone-aware event (for international use)
const timezoneEvent: Event = {
  id: '3',
  title: 'International Call',
  start: Temporal.ZonedDateTime.from('2024-10-15T10:00:00[America/New_York]'),
  end: Temporal.ZonedDateTime.from('2024-10-15T11:00:00[America/New_York]'),
};
```

## Migration Strategies

## Migration Approach

The library **requires** the use of Temporal API for all events. You need to migrate your `Date` objects to Temporal:

```tsx
import { Temporal } from 'temporal-polyfill';
import {
  useCalendarApp,
  DayFlowCalendar,
  createMonthView,
  Event,
} from 'dayflow';

const events: Event[] = [
  {
    id: '1',
    title: 'Team Meeting',
    start: Temporal.ZonedDateTime.from('2024-10-15T10:00:00[Australia/Sydney]'),
    end: Temporal.ZonedDateTime.from('2024-10-15T11:00:00[Australia/Sydney]'),
    color: '#3b82f6',
  },
  {
    id: '2',
    title: 'All Day Conference',
    start: Temporal.PlainDate.from('2024-10-20'),
    end: Temporal.PlainDate.from('2024-10-22'),
    allDay: true,
    color: '#10b981',
  },
];

const calendar = useCalendarApp({
  views: [createMonthView()],
  events,
});

return <DayFlowCalendar calendar={calendar} />;
```

## Common Patterns

### Creating Events

**Date (Old):**

```tsx
const event = {
  id: '1',
  title: 'Meeting',
  start: new Date(2024, 9, 15, 10, 0), // October 15, 10:00 AM
  end: new Date(2024, 9, 15, 11, 0), // October 15, 11:00 AM
};
```

**Temporal (New) - Simple Approach (Recommended):**

```tsx
import { createEvent } from 'dayflow';

const event = createEvent({
  id: '1',
  title: 'Meeting',
  date: new Date(2024, 9, 15),
  startTime: { hour: 10, minute: 0 },
  endTime: { hour: 11, minute: 0 },
});
// Creates PlainDateTime automatically (no timezone complexity)
```

**Temporal (New) - Direct API:**

```tsx
import { Temporal } from 'temporal-polyfill';

// Local event with PlainDateTime (recommended)
const localEvent = {
  id: '1',
  title: 'Meeting',
  start: Temporal.PlainDateTime.from({
    year: 2024, month: 10, day: 15,
    hour: 10, minute: 0
  }),
  end: Temporal.PlainDateTime.from({
    year: 2024, month: 10, day: 15,
    hour: 11, minute: 0
  }),
};

// Timezone-aware event with ZonedDateTime (when needed)
const timezoneEvent = {
  id: '2',
  title: 'International Call',
  start: Temporal.ZonedDateTime.from('2024-10-15T10:00:00[America/New_York]'),
  end: Temporal.ZonedDateTime.from('2024-10-15T11:00:00[America/New_York]'),
};
```

### Getting Current Time

**Date (Old):**

```tsx
const now = new Date();
const today = new Date();
today.setHours(0, 0, 0, 0);
```

**Temporal (New):**

```tsx
import { now, today } from 'dayflow';

const nowTime = now(); // Temporal.ZonedDateTime
const todayDate = today(); // Temporal.PlainDate
```

### Comparing Dates

**Date (Old):**

```tsx
const isSameDay = (date1: Date, date2: Date) => {
  return (
    date1.getFullYear() === date2.getFullYear() &&
    date1.getMonth() === date2.getMonth() &&
    date1.getDate() === date2.getDate()
  );
};
```

**Temporal (New):**

```tsx
import { isSamePlainDate } from 'dayflow';

const same = isSamePlainDate(date1, date2);

// Or directly
const same =
  Temporal.PlainDate.compare(date1.toPlainDate(), date2.toPlainDate()) === 0;
```

### Date Arithmetic

**Date (Old):**

```tsx
const tomorrow = new Date();
tomorrow.setDate(tomorrow.getDate() + 1);

const nextWeek = new Date();
nextWeek.setDate(nextWeek.getDate() + 7);
```

**Temporal (New):**

```tsx
const tomorrow = today().add({ days: 1 });
const nextWeek = today().add({ weeks: 1 });
const nextMonth = today().add({ months: 1 });

// For ZonedDateTime
const inOneHour = now().add({ hours: 1 });
```

### Formatting Dates

**Date (Old):**

```tsx
const formatted = date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
```

**Temporal (New):**

```tsx
const formatted = plainDate.toLocaleString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

// Or use toString()
const iso = plainDate.toString(); // "2024-10-15"
```

## Conversion Utilities

The library provides utilities to help you convert between `Date` and Temporal:

```tsx
import {
  // Date → Temporal conversion
  dateToZonedDateTime,
  dateToPlainDate,

  // Temporal → Date conversion
  zonedDateTimeToDate,
  plainDateToDate,
  temporalToDate,

  // Type guards
  isPlainDate,
  isZonedDateTime,

  // Utility functions
  extractHourFromDate,
  isSameDay,
  isMultiDayTemporalEvent,
} from 'dayflow';

// Example: Converting legacy events from backend
async function loadEventsFromBackend(): Promise<Event[]> {
  const legacyEvents = await api.getEvents(); // Returns events with Date objects

  // Manually convert each event to use Temporal
  return legacyEvents.map(legacyEvent => ({
    id: legacyEvent.id,
    title: legacyEvent.title,
    description: legacyEvent.description,
    start: legacyEvent.allDay
      ? dateToPlainDate(legacyEvent.start)
      : dateToZonedDateTime(legacyEvent.start, 'Australia/Sydney'),
    end: legacyEvent.allDay
      ? dateToPlainDate(legacyEvent.end)
      : dateToZonedDateTime(legacyEvent.end, 'Australia/Sydney'),
    allDay: legacyEvent.allDay,
    color: legacyEvent.color,
    meta: legacyEvent.meta,
  }));
}

// Example: Converting Temporal events to Date for backend
async function saveEvent(event: Event) {
  const legacyEvent = {
    ...event,
    start: temporalToDate(event.start),
    end: temporalToDate(event.end),
  };
  await api.saveEvent(legacyEvent);
}
```

## Timezone Handling

One of the biggest improvements with Temporal is explicit timezone handling:

```tsx
// Create event in specific timezone
const event: Event = {
  id: '1',
  title: 'Remote Meeting',
  start: Temporal.ZonedDateTime.from('2024-10-15T10:00:00[America/New_York]'),
  end: Temporal.ZonedDateTime.from('2024-10-15T11:00:00[America/New_York]'),
};

// Convert to different timezone
const inSydney = event.start.withTimeZone('Australia/Sydney');
console.log(inSydney.toString());
// Output: "2024-10-16T01:00:00+11:00[Australia/Sydney]"

// Get local timezone
const localTz = Temporal.Now.timeZoneId();
const inLocalTz = event.start.withTimeZone(localTz);
```

## Best Practices

### 1. Use PlainDate for All-Day Events

```tsx
// Good ✅
const allDayEvent: Event = {
  id: '1',
  title: 'Holiday',
  start: Temporal.PlainDate.from('2024-12-25'),
  end: Temporal.PlainDate.from('2024-12-25'),
  allDay: true,
};

// Avoid ❌
const allDayEvent: Event = {
  id: '1',
  title: 'Holiday',
  start: Temporal.ZonedDateTime.from('2024-12-25T00:00:00[UTC]'),
  end: Temporal.ZonedDateTime.from('2024-12-25T23:59:59[UTC]'),
  allDay: true,
};
```

### 2. Always Specify Timezone for ZonedDateTime

```tsx
// Good ✅
const event = {
  start: Temporal.ZonedDateTime.from('2024-10-15T10:00:00[Australia/Sydney]'),
  end: Temporal.ZonedDateTime.from('2024-10-15T11:00:00[Australia/Sydney]'),
};

// Risky ❌ (relies on system timezone)
const event = {
  start: Temporal.Now.zonedDateTimeISO(),
  end: Temporal.Now.zonedDateTimeISO().add({ hours: 1 }),
};
```

### 3. Use Type Guards

```tsx
import { isPlainDate, isZonedDateTime, Event } from 'dayflow';

function formatEventTime(event: Event): string {
  if (isPlainDate(event.start)) {
    // All-day event
    return event.start.toString();
  } else {
    // Timed event
    return event.start.toLocaleString();
  }
}
```

## Migration Strategy

**Important:** The library does **not** support legacy `Date` objects directly. All events must use Temporal API.

### Step-by-Step Migration

1. **Install the polyfill** - Add `temporal-polyfill` to your project
2. **Create conversion utilities** - Use the provided conversion functions
3. **Convert your events** - Transform all `Date` objects to Temporal
4. **Update event creation** - Use Temporal API for new events
5. **Test thoroughly** - Verify timezone handling works correctly

### Example Migration

**Before (using Date):**

```tsx
const events = [
  {
    id: '1',
    title: 'Meeting',
    start: new Date(2024, 9, 15, 10, 0),
    end: new Date(2024, 9, 15, 11, 0),
  },
];
```

**After (using Temporal):**

```tsx
import { Temporal } from 'temporal-polyfill';

const events = [
  {
    id: '1',
    title: 'Meeting',
    start: Temporal.ZonedDateTime.from('2024-10-15T10:00:00[America/New_York]'),
    end: Temporal.ZonedDateTime.from('2024-10-15T11:00:00[America/New_York]'),
  },
];
```

## Browser Support

Temporal is a polyfill until it becomes native in browsers:

```tsx
// Already included in react-calendar-package
import { Temporal } from 'temporal-polyfill';
```

The polyfill works in:

- Chrome/Edge 90+
- Firefox 88+
- Safari 14+
- Node.js 16+

## Resources

- [Temporal Documentation](https://tc39.es/proposal-temporal/docs/)
- [Temporal Cookbook](https://tc39.es/proposal-temporal/docs/cookbook.html)
- [temporal-polyfill GitHub](https://github.com/js-temporal/temporal-polyfill)

## Need Help?

If you encounter issues during migration:

1. Check the [API Reference](/docs/api-reference) for utility functions
2. Review the [examples directory](https://github.com/yourusername/react-calendar-package/tree/main/examples)
3. Open an issue on [GitHub](https://github.com/yourusername/react-calendar-package/issues)
