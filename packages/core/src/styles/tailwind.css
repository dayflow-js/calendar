@import 'tailwindcss/preflight' layer(base);
@import 'tailwindcss/theme' layer(theme);
@import 'tailwindcss/utilities';
@import '@dayflow/blossom-color-picker/styles.css';

/* Force scanning of all relevant source code files to extract utility classes */
@source "../**/*.{ts,tsx}";
@source "../../../core/*/src/**/*.{ts,tsx}";
@source "../../../plugins/*/src/**/*.{ts,tsx}";

@variant dark (.dark &);

/* Ensure that the base variables can be correctly parsed even without Tailwind */
:root {
  color-scheme: light dark;
}

/*
 * Library theme variables are:
 *   1. Namespaced with --df-color-* to avoid colliding with any host --color-* tokens.
 *   2. Wrapped in @layer df-theme so host apps can place their own layer above
 *      this one to override values without !important:
 *
 *        @layer df-theme, my-overrides;   ← declare before importing the library CSS
 *
 * Non-Tailwind users get sensible defaults; Tailwind users retain full control
 * of their own --color-* tokens.
 */
@layer df-theme {
  :where(:root) {
    /* Light mode colors */
    --df-color-background:           rgb(255 255 255);
    --df-color-foreground:           rgb(46 46 46);
    --df-color-hover:                rgb(245 245 245);
    --df-color-border:               rgb(229 229 229);
    --df-color-card:                 rgb(255 255 255);
    --df-color-card-foreground:      rgb(46 46 46);
    --df-color-muted:                rgb(243 244 246);
    --df-color-muted-foreground:     rgb(107 114 128);

    /* Theme colors */
    --df-color-primary:              rgb(46 46 46);
    --df-color-primary-foreground:   rgb(255 255 255);
    --df-color-secondary:            rgb(100 116 139);
    --df-color-secondary-foreground: rgb(255 255 255);

    /* Destructive */
    --df-color-destructive:            rgb(212 36 34);
    --df-color-destructive-foreground: rgb(255 255 255);
  }

  :where(.dark) {
    /* Dark mode colors */
    --df-color-background:           rgb(21 21 21);
    --df-color-hover:                rgb(28 28 28);
    --df-color-foreground:           rgb(229 229 229);
    --df-color-card:                 rgb(31 41 55);
    --df-color-card-foreground:      rgb(229 229 229);
    --df-color-border:               rgb(56 56 56);
    --df-color-muted:                rgb(55 65 81);
    --df-color-muted-foreground:     rgb(156 163 175);

    --df-color-primary:              rgb(229 229 229);
    --df-color-primary-foreground:   rgb(23 23 23);
    --df-color-secondary:            rgb(156 163 175);
    --df-color-secondary-foreground: rgb(23 23 23);

    /* Destructive */
    --df-color-destructive:            rgb(147 70 69);
    --df-color-destructive-foreground: rgb(254 242 242);
  }

  /* System-preference dark mode — no explicit .dark or .light class on <html>.
   * All variables are defined here to prevent partial dark mode where omitted
   * tokens fall back to their light-mode values from :where(:root). */
  @media (prefers-color-scheme: dark) {
    :root:not(.light):not(.dark) {
      --df-color-background:           rgb(21 21 21);
      --df-color-hover:                rgb(28 28 28);
      --df-color-foreground:           rgb(229 229 229);
      --df-color-border:               rgb(56 56 56);
      --df-color-card:                 rgb(31 41 55);
      --df-color-card-foreground:      rgb(229 229 229);
      --df-color-muted:                rgb(55 65 81);
      --df-color-muted-foreground:     rgb(156 163 175);
      --df-color-primary:              rgb(229 229 229);
      --df-color-primary-foreground:   rgb(23 23 23);
      --df-color-secondary:            rgb(156 163 175);
      --df-color-secondary-foreground: rgb(23 23 23);
      --df-color-destructive:          rgb(147 70 69);
      --df-color-destructive-foreground: rgb(254 242 242);
    }
  }
}

/*
 * Map Tailwind's internal color tokens to the library's namespaced variables.
 * Using @theme inline means generated utilities reference --df-color-* directly
 * (e.g. `.bg-primary { background-color: var(--df-color-primary) }`),
 * so the host's own --color-primary is never touched.
 */
@theme inline {
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);

  --color-background:           var(--df-color-background);
  --color-foreground:           var(--df-color-foreground);
  --color-hover:                var(--df-color-hover);
  --color-border:               var(--df-color-border);
  --color-card:                 var(--df-color-card);
  --color-card-foreground:      var(--df-color-card-foreground);
  --color-muted:                var(--df-color-muted);
  --color-muted-foreground:     var(--df-color-muted-foreground);

  --color-primary:              var(--df-color-primary);
  --color-primary-foreground:   var(--df-color-primary-foreground);
  --color-secondary:            var(--df-color-secondary);
  --color-secondary-foreground: var(--df-color-secondary-foreground);

  --color-destructive:            var(--df-color-destructive);
  --color-destructive-foreground: var(--df-color-destructive-foreground);
}

/* ==================== Component Layer ==================== */

@layer components {
  .df-calendar-container {
    @apply relative flex flex-row bg-white dark:bg-gray-900 rounded-lg overflow-hidden shadow-lg border border-gray-200 dark:border-gray-700;
    --df-calendar-height: 800px;
    height: var(--df-calendar-height, 800px);
  }

  @media (max-width: 768px) {
    .df-calendar-container {
      --df-calendar-height: 550px;
    }
  }

  .calendar-time-column {
    @apply w-20 shrink-0 border-gray-200 dark:border-gray-700;
  }

  .calendar-nav-button {
    @apply p-1 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors;
  }

  .calendar-today-button {
    @apply px-4 py-1 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors;
  }

  .calendar-checkbox {
    @apply mr-2 h-4 w-4 inline-flex items-center justify-center border border-gray-300 dark:border-gray-600 rounded-sm cursor-pointer;
    appearance: none;
    background-color: transparent;
    position: relative;
  }

  .calendar-checkbox:focus-visible {
    outline: 2px solid var(--checkbox-color, #3b82f6);
    outline-offset: 2px;
  }

  .calendar-checkbox:checked {
    background-color: var(--checkbox-color, #3b82f6);
    border-color: var(--checkbox-color, #3b82f6);
  }

  .calendar-checkbox:checked::after {
    content: '';
    display: block;
    width: 0.25rem;
    height: 0.5rem;
    border: solid #fff;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
  }
}

/* ==================== Utilities ==================== */

@keyframes fadeOut {
  from {
    opacity: 1;
  }

  to {
    opacity: 0;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes zoomIn {
  from {
    transform: scale(0.95);
  }
  to {
    transform: scale(1);
  }
}

.animate-in {
  animation-duration: 200ms;
  animation-fill-mode: forwards;
  animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
}

.fade-in {
  animation-name: fadeIn;
}

.zoom-in-95 {
  animation-name: zoomIn;
}

.fade-in.zoom-in-95 {
  animation-name: fadeIn, zoomIn;
}

@keyframes slideUp {
  from {
    transform: translateY(100%);
  }
  to {
    transform: translateY(0);
  }
}

@keyframes slideDown {
  from {
    transform: translateY(0);
  }
  to {
    transform: translateY(100%);
  }
}

.animate-slide-up {
  animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.animate-slide-down {
  animation: slideDown 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

@media (max-width: 767px) {
  .mobile-mask-fade {
    mask-image: linear-gradient(to right, black 70%, transparent 100%);
    -webkit-mask-image: linear-gradient(to right, black 70%, transparent 100%);
  }
}

/* Hide scrollbar but allow scrolling */
.scrollbar-hide::-webkit-scrollbar {
  display: none;
}

.scrollbar-hide {
  -ms-overflow-style: none; /* IE and Edge */
  scrollbar-width: none; /* Firefox */
}

/*
 * Scrollbar styles scoped to the calendar container.
 * Global * and ::-webkit-scrollbar selectors are intentionally avoided to
 * prevent leaking into the host application's scrollable areas.
 */
.df-calendar-container *::-webkit-scrollbar {
  width: 2px;
  height: 2px;
}

.df-calendar-container *::-webkit-scrollbar-track {
  background: transparent;
}

.df-calendar-container *::-webkit-scrollbar-thumb {
  background: #d1d5db; /* gray-300 */
  border-radius: 1px;
}

.dark .df-calendar-container *::-webkit-scrollbar-thumb {
  background: #4b5563; /* gray-600 */
}

.df-calendar-container *::-webkit-scrollbar-thumb:hover {
  background: #9ca3af; /* gray-400 */
}

.df-calendar-container * {
  scrollbar-width: thin; /* Firefox */
  scrollbar-color: #d1d5db transparent; /* Firefox */
}

.dark .df-calendar-container * {
  scrollbar-color: #4b5563 transparent; /* Firefox */
}

.df-header-left {
  flex: 1;
}

.df-header-mid {
  flex: 1;
}

.df-header-right {
  flex: 1;
}
